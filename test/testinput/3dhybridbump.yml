test_framework_runtime_config: "--log_level=test_suite"
resolution: 
  num_ice_cat: 5
  num_ice_lev: 4
  num_sno_lev: 1
model: 
 name: SOCA
 tstep: PT12H
cost_function: 
 cost_type: 4D-Var
 window_begin: 2018-04-14T00:00:00Z
 window_length: PT24H
 variables:
  - cicen
  - hicen
  - hsnon
  - tsfcn
  - qsnon
  - sicnk
  - qicnk
  - socn
  - tocn
  - ssh
  - hocn  
 Jb: 
  Background: 
   state:
   - read_from_file: 1
     basename: "./INPUT/"
     ocn_filename: MOM.res.nc
     ice_filename: ice_model.res.nc
     date: 2018-04-14T00:00:00Z
     variables: [cicen, hicen, socn, tocn, ssh, hocn]       
  Covariance: 
   covariance: hybrid
   ensemble_weight: "0.3"
   static: 
    covariance: SocaError
    default_seed: 1
    prefix: soca
    datadir: ./bump
    method: cor
    strategy: common      
    new_nicas: 0   # 1: recomputes convol param
    load_nicas: 1  # 1: loads convol param (layout specific)
    sam_read: 0
    sam_write: 1  
    mask_check: 1
    draw_type: random_uniform
    nc1: 100
    ntry: 3
    nrep:  2
    nc3: 10
    dc: 1000.0e3
    nl0r: 1
    minim_algo: "hooke"
    rvflt: 0.0
    lsqrt: 1  
    resol: 8.0
    nicas_interp: bilin
    network: 1
    mpicom: 2 # Number of internal comm steps 
    forced_radii: 1
    rh: 3000e3
    rv: 100
    advmode: 0
    diag_interp: bilin
    date: '2018-04-14T00:00:00Z'
    variable_changes:
    - varchange: BalanceSOCA
      dsdtmax: 1.0
      dsdzmin: 3.0e-6
      dtdzmin: 1.0e-6
      nlayers: 10
      inputVariables:
        variables:
        - socn
        - tocn
        - ssh
        - hocn
      outputVariables:
        variables:
        - socn
        - tocn
        - ssh
        - hocn            
    - varchange: BkgErrSOCA
      read_from_file: 3
      basename: ./
      ocn_filename: ocn.bkgerror.nc
      ice_filename: ice.bkgerror.nc      
      date: 2018-04-14T00:00:00Z
      filename: std_bkgerror.nc
      variables: [cicen, hicen, socn, tocn, ssh, hocn]
      t_min: 0.01
      t_max: 5.0
      s_min: 0.01
      s_max: 1.0
      ssh_min: 0.01
      ssh_max: 0.5      
      variables:                                
        variables:
        - socn
        - tocn
        - ssh
        - hocn      
      inputVariables:
        variables:
        - socn
        - tocn
        - ssh
        - hocn  
      outputVariables:
        variables:
        - socn
        - tocn
        - ssh
        - hocn	  
    - varchange: VertConvSOCA
      variables:                                
        variables:
        - socn
        - tocn
        - hocn      
      Lz: 300.0
      Ltemp: 10.0	
      inputVariables:
        variables:
        - socn
        - tocn
      outputVariables:
        variables:
        - socn
        - tocn	  
   ensemble: 
    members: 4
    variables: 
     variables: 
      - cicen
      - hicen
      - hsnon
      - tsfcn
      - qsnon
      - sicnk
      - qicnk
      - socn
      - tocn
      - ssh
      - hocn  
    date: 2018-04-14T00:00:00Z
    localization: 
     localization: BUMP
     date: 2018-04-14T00:00:00Z
     variables: 
      variables:
      - cicen
      - hicen
      - hsnon
      - tsfcn
      - qsnon
      - sicnk
      - qicnk
      - socn
      - tocn
      - ssh
      - hocn
     prefix: soca_4dhybridbump
     default_seed: 1
     method: loc #_norm
     strategy: common
     new_hdiag: 0 #1
     new_nicas: 1
     mask_type: none
     draw_type: random_uniform
     nc1: 400
     ntry: 3
     nrep: 2
     nc3: 10
     dc: 1000000
     nl0r: 1
     ne: 4
     minim_algo: hooke
     rvflt: 0
     lsqrt: 1
     resol: 10
     nicas_interp: bilin
     network: 0
     mpicom: 2
     advmode: 0
     diag_interp: bilin
     forced_radii: 1
     rh: 30000e3
     rv: 1000
    state:
     - read_from_file: 1
       date: 2018-04-14T00:00:00Z
       basename: ./Data/
       ocn_filename: ocn.test.ens.1.2018-04-15T00:00:00Z.PT1H.nc
       ice_filename: ice.test.ens.1.2018-04-15T00:00:00Z.PT1H.nc
       variables: [cicen, hicen, socn, tocn, ssh, hocn]
     - read_from_file: 1
       date: 2018-04-14T00:00:00Z
       basename: ./Data/
       ocn_filename: ocn.test.ens.2.2018-04-15T00:00:00Z.PT1H.nc
       ice_filename: ice.test.ens.2.2018-04-15T00:00:00Z.PT1H.nc
       variables: [cicen, hicen, socn, tocn, ssh, hocn]
     - read_from_file: 1
       date: 2018-04-14T00:00:00Z
       basename: ./Data/
       ocn_filename: ocn.test.ens.3.2018-04-15T00:00:00Z.PT1H.nc
       ice_filename: ice.test.ens.3.2018-04-15T00:00:00Z.PT1H.nc
       variables: [cicen, hicen, socn, tocn, ssh, hocn]
     - read_from_file: 1
       date: 2018-04-14T00:00:00Z
       basename: ./Data/
       ocn_filename: ocn.test.ens.4.2018-04-15T00:00:00Z.PT1H.nc
       ice_filename: ice.test.ens.4.2018-04-15T00:00:00Z.PT1H.nc
       variables: [cicen, hicen, socn, tocn, ssh, hocn]
 Jo: 
  ObsTypes:
  - ObsType: ADT
    ObsData:
      ObsDataOut:
        obsfile: Data/test_obsout.nc
      ObsDataIn:
        obsfile: Data/Jason-2-2018-04-15-soca.nc
#      obsvalue: obs_absolute_dynamic_topography
    Covariance:
      covariance: diagonal
#      obserror: obs_absolute_dynamic_topography_err  
xminimizer: 
 algorithm: DRPCG
output: 
 first: PT0S
 frequency: PT06H
 datadir: Data
 exp: 4dhyb
 type: an
variational: 
 iteration:
  - resolution:
      num_ice_cat: 5
      num_ice_lev: 4
      num_sno_lev: 1
    linearmodel:
      varchange: Identity
      version: IdTLM
  tstep: PT1H
  advance_mom6: 1
