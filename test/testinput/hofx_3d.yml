geometry:
  geom_grid_file: data_generated/gridgen/soca_gridspec.72x35x25.nc
  mom6_input_nml: data_static/72x35x25/input.nml
  fields metadata: data_static/fields_metadata.yml

state:
    date: 2018-04-15T00:00:00Z
    read_from_file: 1
    basename: data_static/72x35x25/restarts/
    ocn_filename: MOM.res.nc
    ice_filename: cice.res.nc
    sfc_filename: sfc.res.nc
    state variables: [cicen, hicen, hsnon, socn, tocn, ssh, hocn, uocn, vocn, sw, lhf, shf, lw, us, chl]

window begin: 2018-04-14T00:00:00Z
window length: P2D

observations:
  observers:
  - obs space:
      name: CoolSkin
      obsdataout: {obsfile: data_generated/hofx_3d/sst_coolskin.hofx_3d.nc}
      obsdatain:  {obsfile: data_static/obs/sst.nc}
      simulated variables: [sea_surface_temperature]
    obs operator:
      name: CoolSkin

  - obs space:
      name: SeaSurfaceTemp
      obsdataout: {obsfile: data_generated/hofx_3d/sst.hofx_3d.nc}
      obsdatain:  {obsfile: data_static/obs/sst.nc}
      simulated variables: [sea_surface_temperature]
    obs operator:
      name: Identity

  - obs space:
      name: SeaSurfaceSalinity
      obsdataout: {obsfile: data_generated/hofx_3d/sss.hofx_3d.nc}
      obsdatain:  {obsfile: data_static/obs/sss.nc}
      simulated variables: [sea_surface_salinity]
    obs operator:
      name: Identity

  - obs space:
      name: ADT
      obsdataout: {obsfile: data_generated/hofx_3d/adt.hofx_3d.nc}
      obsdatain:  {obsfile: data_static/obs/adt.nc}
      simulated variables: [absolute_dynamic_topography]
    obs operator:
      name: ADT

  - obs space:
      name: InsituTemperature
      obsdataout: {obsfile: data_generated/hofx_3d/prof_T.hofx_3d.nc}
      obsdatain:  {obsfile: data_static/obs/prof.nc}
      simulated variables: [sea_water_temperature]
    obs operator:
      name: InsituTemperature

  - obs space:
      name: InsituSalinity
      obsdataout: {obsfile: data_generated/hofx_3d/prof_S.hofx_3d.nc}
      obsdatain:  {obsfile: data_static/obs/prof.nc}
      simulated variables: [sea_water_salinity]
    obs operator:
      name: MarineVertInterp

  - obs space:
      name: SeaIceFraction
      obsdataout: {obsfile: data_generated/hofx_3d/icec.hofx_3d.nc}
      obsdatain:  {obsfile:  data_static/obs/icec.nc}
      simulated variables: [sea_ice_area_fraction]
    obs operator:
      name: SeaIceFraction

  - obs space:
      name: SeaIceFreeboard
      obsdataout: {obsfile: data_generated/hofx_3d/icefb.hofx_3d.nc}
      obsdatain:  {obsfile:  data_static/obs/icefb.nc}
      simulated variables: [sea_ice_freeboard]
    obs operator:
      name: SeaIceThickness

  - obs space:
      name: Chlorophyll
      obsdataout: {obsfile: data_generated/hofx_3d/chl.hofx_3d.nc}
      obsdatain:  {obsfile:  data_static/obs/chl.nc}
      simulated variables: [mass_concentration_of_chlorophyll_in_sea_water]
    obs operator:
      name: Chlorophyll Ocean Color
    obs filters:
    - filter: Gaussian_Thinning
      horizontal_mesh:   111
      use_reduced_horizontal_grid: false
    - filter: Domain Check
      filter variables:
      - name: mass_concentration_of_chlorophyll_in_sea_water
      where:
      - variable:
          name: mass_concentration_of_chlorophyll_in_sea_water@ObsValue
        minvalue: 0.001
        maxvalue: 10.0
      - variable:
          name: latitude@MetaData
        minvalue: -60.0
        maxvalue:  60.0
      action:
        name: reject
      where:
      - variable:
          name: mass_concentration_of_chlorophyll_in_sea_water@PreQC
        any_bit_set_of: 0,1,3,4,5,8,9,10,12,14,15,16,19,21,22,25
      action:
        name: inflate error
        inflation factor: 2.0

  - obs space:
      name: SurfaceU
      obsdataout: {obsfile: data_generated/hofx_3d/uocn_surface.hofx_3d.nc}
      obsdatain:  {obsfile: data_static/obs/uocn_surface.nc}
      simulated variables: [surface_eastward_sea_water_velocity]
    obs operator:
      name: Identity

  - obs space:
      name: SurfaceV
      obsdataout: {obsfile: data_generated/hofx_3d/vocn_surface.hofx_3d.nc}
      obsdatain:  {obsfile: data_static/obs/vocn_surface.nc}
      simulated variables: [surface_northward_sea_water_velocity]
    obs operator:
      name: Identity

test:
  reference filename: testref/hofx_3d.test
  test output filename: testoutput/hofx_3d.test