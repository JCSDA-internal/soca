#
#                               3DVAR FGAT
#
#     <---------------------- window_length (6 hours) ---------------------->
#
# ---|-----------|-----------|-----------|-----------|-----------|-----------|
#    |                                   |                                   |      
# window_begin: 2015-01-01T09:00:00Z     |                           2015-01-01T15:00:00Z
#                                        |
#                       bkg/ana/incr: 2015-01-01T12:00:00Z
#
#

test_framework_runtime_config: "--log_level=test_suite"
resolution:
model:
  tstep: PT1H
cost_function:
  cost_type: 4D-Var
  window_begin: '2018-04-14T21:00:00Z'
  window_length: PT6H
  variables:
  - cicen
  - hicen
  - hsnon
  - tsfcn
  - qsnon
  - sicnk
  - qicnk
  - socn
  - tocn
  - ssh
  Jb:
    Background:
      state:
      - read_from_file: 1
        basename: "./INPUT/"
        ocn_sfc_filename: MOM.res.nc
        ocn_filename: MOM.res.nc
        ice_filename: ice_model.res.nc
        #date: '2018-04-15T00:00:00Z'
        date: '2018-04-14T21:00:00Z'        
    Covariance:
      covariance: SocaError
      sig_sic: 0.1#.0001
      sig_sit: 250.0
      sig_ssh: 0.2      
      date: '2018-04-14T21:00:00Z'
      #date: '2018-04-15T00:00:00Z'      
  Jo:      
    ObsTypes:
    - ObsType: SeaIceThickness
      ObsData:
        ObsDataOut:
          obsfile: Data/test_obsout.nc
        ObsDataIn:
          obsfile: /home/gvernier/Data/CS2/cryosat2-nrt-nh-20171030-v2.0.nc
        obsvalue: ObsVal        
      Covariance:
        covariance: diagonal
        obserror: ObsErr
    - ObsType: StericHeight
      ObsData:
        ObsDataOut:
          obsfile: Data/test_obsout.nc
        ObsDataIn:
          obsfile: Data/Jason-3-2018-04-15.nc
        obsvalue: ObsVal        
      Covariance:
        covariance: diagonal
        obserror: ObsErr	
    - ObsType: SeaIceFraction
      ObsData:
        ObsDataOut:
          obsfile: Data/test_obsout.nc
        ObsDataIn:
          obsfile: Data/seaice_obs-2018-04-15.nc
        obsvalue: ObsVal        
      Covariance:
        covariance: diagonal
        obserror: ObsErr
variational:
  iteration:
  - resolution: {}
    linearmodel:
      version: IdTLM
      tstep: PT1H
    ninner: 10
    gradient_norm_reduction: 1e-15
    test: 'on'
  - resolution: {}
    linearmodel:
      version: IdTLM
      tstep: PT1H
    ninner: 3
    gradient_norm_reduction: 1e-15
    test: 'on'
  - resolution: {}
    linearmodel:
      version: IdTLM
      tstep: PT1H
    ninner: 3
    gradient_norm_reduction: 1e-15
    test: 'on'
minimizer:
  algorithm: DRIPCG
output:
  datadir: Data
  exp: 3dvarfgat
  type: an
final:
  diagnostics:
    departures: oman
prints:
  frequency: PT3H
