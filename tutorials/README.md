# A tutorial for `soca`
After successfully starting an instance of a singularity container and
compiling `soca`, a `tutorials` directory is installed under
`<path to build>/soca/tutorials`. It contain all the necessary resources
required to run a low resolution MOM6 forecast model and the `soca`
tutorial applications.

The objective of the tutorial is to provide some examples of the basic steps
required to run the `soca` applications.
The scenario of the tutorial is as follows,
generate synthetic observations from a perturbed MOM6 forecast and subsequently
assimilate the synthetic observations using the unperturbed background as
initial conditions.

## Content of `tutorials`

``` console
├── CMakeLists.txt                    # configure the tutorial
├── config                            # yaml configurations
│   ├── checkpoint_model.yaml         # copy a state to MOM6 restart file
│   ├── ensemble_perturbations.yaml   # B-matrix randomization
│   ├── gridgen.yaml                  # `soca` grid generation
│   ├── staticb.yaml                  # horizontal convolution
│   └── synthetic_obs.yaml            # generate synthetic obs
├── soca_3dvarfgat.sh                 # driver for a 3D Var FGAT example
├── prep.mom6-soca.static.sh          # copy the MOM6 and `soca` resource files
├── README.md                         # this file
├── soca_ensemble_perturbations.sh    # driver for the B-matrix randomization
├── soca_gridgen.sh                   # driver for the grid generation
├── soca_static_correlation_op.sh     # driver to initialize the horizontal convolution
├── soca_synthetic_observations.py    # generate random locations for observations
└── soca_synthetic_observations.sh    # driver for the generation of synthetic observations
```

## Running the tutorial applications
`cd` into the tutorials directory where `soca` was built,
``` console
cd <path to build>/soca/tutorials
```
#### Generate the `soca` grid
``` console
./soca_gridgen.sh
```
this will create a file `soca_gridspec.nc` under `<path to build>/soca/tutorials/static/`
that will be needed by all the other applications

#### Initialize the horizontal correlation operator
``` console
./soca_static_correlation_op.sh
```
This application is using `BUMP` from the `saber` repository to create the
static correlation operator used in the subsequent applications.

#### Perturb the background
This application randomizes a static background error covariance matrix to
generate a single perturbed background.
Note that an ensemble of perturbations can be generated by editing the yaml
configuration file `tutorial/config/ensemble_perturbation.yaml`

```console
./soca_ensemble_perturbations.sh
```

#### Create synthetic observations
``` console
./soca_synthetic_observations.sh
```

#### Simple 3DVAR example

#### Assimilate synthetic observations and cycle
Here a 3Dvar FGAT is used to show an example of configuration of a data assimilation experiment,
cycling through 3 days.
The data assimilation window is 24 hours and the synthetic observations assimilated are
sea surface temperature, sea surface salinity, insitu temperature and salinity and
absolute dynamic topography.

```console
./soca_3dvarfgat.sh
```
